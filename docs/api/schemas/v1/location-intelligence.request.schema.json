{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://geo-ranking-ch.local/docs/api/schemas/v1/location-intelligence.request.schema.json",
  "title": "LocationIntelligenceRequestV1",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "input",
    "requested_modules"
  ],
  "properties": {
    "request_id": {
      "type": "string",
      "minLength": 1,
      "maxLength": 128,
      "pattern": "^[\\x21-\\x7E]+$"
    },
    "input": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "mode"
      ],
      "properties": {
        "mode": {
          "type": "string",
          "enum": [
            "address",
            "point"
          ]
        },
        "address": {
          "type": "string",
          "minLength": 3
        },
        "point": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "lat",
            "lon"
          ],
          "properties": {
            "lat": {
              "type": "number",
              "minimum": 45.0,
              "maximum": 48.5
            },
            "lon": {
              "type": "number",
              "minimum": 5.0,
              "maximum": 11.5
            }
          }
        }
      },
      "allOf": [
        {
          "if": {
            "properties": {
              "mode": {
                "const": "address"
              }
            }
          },
          "then": {
            "required": [
              "address"
            ]
          }
        },
        {
          "if": {
            "properties": {
              "mode": {
                "const": "point"
              }
            }
          },
          "then": {
            "required": [
              "point"
            ]
          }
        }
      ]
    },
    "requested_modules": {
      "type": "array",
      "minItems": 1,
      "uniqueItems": true,
      "items": {
        "type": "string",
        "enum": [
          "building_profile",
          "context_profile",
          "suitability_light",
          "explainability"
        ]
      }
    },
    "options": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "language": {
          "type": "string",
          "enum": [
            "de",
            "en",
            "fr",
            "it"
          ]
        },
        "timeout_seconds": {
          "type": "number",
          "exclusiveMinimum": 0,
          "maximum": 60
        },
        "response_mode": {
          "type": "string",
          "enum": [
            "compact",
            "verbose"
          ]
        },
        "include_labels": {
          "type": "boolean"
        },
        "capabilities": {
          "type": "object",
          "additionalProperties": true
        },
        "entitlements": {
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "preferences": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "preset": {
          "type": "string",
          "enum": [
            "urban_lifestyle",
            "family_friendly",
            "quiet_residential",
            "car_commuter",
            "pt_commuter"
          ]
        },
        "preset_version": {
          "type": "string",
          "enum": [
            "v1"
          ],
          "default": "v1"
        },
        "lifestyle_density": {
          "type": "string",
          "enum": [
            "rural",
            "suburban",
            "urban"
          ],
          "default": "suburban"
        },
        "noise_tolerance": {
          "type": "string",
          "enum": [
            "low",
            "medium",
            "high"
          ],
          "default": "medium"
        },
        "nightlife_preference": {
          "type": "string",
          "enum": [
            "avoid",
            "neutral",
            "prefer"
          ],
          "default": "neutral"
        },
        "school_proximity": {
          "type": "string",
          "enum": [
            "avoid",
            "neutral",
            "prefer"
          ],
          "default": "neutral"
        },
        "family_friendly_focus": {
          "type": "string",
          "enum": [
            "low",
            "medium",
            "high"
          ],
          "default": "medium"
        },
        "commute_priority": {
          "type": "string",
          "enum": [
            "car",
            "pt",
            "bike",
            "mixed"
          ],
          "default": "mixed"
        },
        "weights": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "lifestyle_density": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "noise_tolerance": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "nightlife_preference": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "school_proximity": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "family_friendly_focus": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "commute_priority": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            }
          }
        }
      },
      "dependentRequired": {
        "preset_version": [
          "preset"
        ]
      }
    }
  }
}
